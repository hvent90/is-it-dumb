DESCRIPTION >
    Models most affected by a specific issue_category.
    Accepts issue_category parameter and returns models with their report counts for that issue.

PARAMETERS >
    issue_category String

NODE reports_deduped
SQL >
    SELECT
        session_id,
        argMax(model_name, timestamp) as model_name,
        argMax(issue_category, timestamp) as issue_category,
        argMax(severity, timestamp) as severity
    FROM llm_events
    WHERE event_type = 'report'
    GROUP BY session_id

NODE affected_models
SQL >
    SELECT
        model_name,
        count() as report_count
    FROM reports_deduped
    WHERE issue_category = {{ String(issue_category) }}
        AND model_name != ''
    GROUP BY model_name
    ORDER BY report_count DESC